api_version: 2.0
metadata:
  id: 006-exploit-insecure-sudo-configuration
  name: Exploit Insecure Sudo Configuration
  description: Attempt to exploit sudo misconfiguration for privilege escalation
  category: privilege_escalation
  sub_category: exploitation
  author: TTPForge
  uuid: 550e8400-e29b-41d4-a716-446655440006
  created: 2026-01-30
  updated: 2026-01-30

requirements:
  platforms:
    - os: darwin
  superuser: false

steps:
  - name: Check for NOPASSWD sudoers entries
    type: command
    description: Identify sudo commands that don't require password
    inline: |
      sudo -l 2>&1 | grep "NOPASSWD"

  - name: List available sudo commands without password
    type: command
    description: Extract commands that can be run without password
    inline: |
      sudo -l 2>&1 | grep -E "NOPASSWD.*=.*\(" | awk '{print $NF}' || echo "No passwordless commands found"

  - name: Check for sudo ALL privilege
    type: command
    description: Detect if user has ALL commands available
    inline: |
      sudo -l 2>&1 | grep -E "\(root\) NOPASSWD: ALL" && echo "CRITICAL: Can run all commands as root without password"

  - name: Enumerate dangerous commands
    type: command
    description: Check for exploitable commands in sudo list
    inline: |
      sudo -l 2>&1 | grep -E "(cat|sed|awk|perl|python|vim|chmod|chown)" || echo "No obvious command injection vectors found"

checks:
  - name: Verify privilege level before exploitation
    type: command
    inline: id

  - name: Verify exploitation success
    type: command
    inline: |
      sudo -l 2>&1 | grep "NOPASSWD" && echo "Passwordless sudo detected" || echo "All sudo commands require password"

tests:
  - name: Detect insecure sudo configuration
    type: dry_run
    description: Safely detect sudo misconfigurations without exploitation
    steps:
      - step: 1
      - step: 2
      - step: 3

cleanup:
  - name: No cleanup required
    type: command
    description: No system modifications were made
    inline: echo "Exploitation test complete - no changes made"
