api_version: 2.0
metadata:
  id: 009-passwordless-sudo-detection
  name: Passwordless Sudo Detection
  description: Detect and exploit passwordless sudo entries for privilege escalation
  category: privilege_escalation
  sub_category: exploitation
  author: TTPForge
  uuid: 550e8400-e29b-41d4-a716-446655440009
  created: 2026-01-30
  updated: 2026-01-30

requirements:
  platforms:
    - os: darwin
  superuser: false

steps:
  - name: Detect passwordless sudo entries
    type: command
    description: Check for NOPASSWD in sudo configuration
    inline: |
      sudo -l 2>&1 | grep "NOPASSWD"

  - name: List all passwordless commands
    type: command
    description: Extract and list all commands runnable without password
    inline: |
      sudo -l 2>&1 | grep "NOPASSWD" | sed 's/.*NOPASSWD://' | tr ',' '\n'

  - name: Check for command-level sudo access
    type: command
    description: Identify specific commands available without password
    inline: |
      sudo -l 2>&1 | grep -E "NOPASSWD.*/" | awk '{print $NF}'

  - name: Test passwordless sudo execution
    type: command
    description: Attempt to run whoami via passwordless sudo
    inline: |
      sudo -n whoami 2>&1

  - name: Verify sudo privileges without authentication
    type: command
    description: Check if sudo can be invoked without password
    inline: |
      sudo -n id 2>&1

checks:
  - name: Check user ID before escalation
    type: command
    inline: id

  - name: Verify successful privilege escalation
    type: command
    inline: |
      sudo -n id 2>&1 | grep -q root && echo "Privilege escalation successful" || echo "Not escalated"

tests:
  - name: Detect passwordless sudo opportunities
    type: dry_run
    description: Safely detect passwordless sudo without executing privilege escalation
    steps:
      - step: 1
      - step: 2

cleanup:
  - name: No cleanup required
    type: command
    description: No system modifications made
    inline: echo "Passwordless sudo detection complete"
