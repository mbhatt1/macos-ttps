api_version: "2.0"
id: "009"
name: "Time Machine Backup Discovery"
description: "Discover and enumerate Time Machine backup destinations for data access"
author: "TTPForge"
created: "2026-01-30"
updated: "2026-01-30"
uuid: "c9daebf2-gde3-bf0f-c8d9-eafb0c1d2e3f"

requirements:
  platforms:
    - os: darwin

args:
  backup_host:
    description: "Host IP address with Time Machine backups"
    type: "string"
    required: true
    default: "192.168.1.250"
  backup_port:
    description: "AFP/SMB port for backup access"
    type: "integer"
    required: false
    default: 548
  backup_share:
    description: "Backup share name"
    type: "string"
    required: false
    default: "TimeMachineBackup"

steps:
  - name: "Enumerate Time Machine backups via AFP"
    executor: "sh"
    command: "afp_client -h {{ backup_host }} -p {{ backup_port }} listshares 2>/dev/null || echo 'Time Machine backup enumeration initiated'"

checks:
  - name: "Verify AFP service for backups"
    executor: "sh"
    command: "nc -w 2 {{ backup_host }} {{ backup_port }} < /dev/null && echo 'AFP port accessible' || echo 'AFP port not accessible'"

tests:
  - name: "Dry run Time Machine backup discovery"
    executor: "sh"
    command: "echo '[DRY RUN] Discovering Time Machine backups on {{ backup_host }}' && echo '[DRY RUN] Backups found:' && echo '[DRY RUN] - iMac (Latest: 2026-01-30)' && echo '[DRY RUN] - MacBook Pro (Latest: 2026-01-29)' && echo '[DRY RUN] - Mac Mini (Latest: 2026-01-28)'"

metadata:
  tactic: "lateral-movement"
  technique: "backup-enumeration"
  references:
    - "https://attack.mitre.org/tactics/TA0008/"
  severity: "medium"
