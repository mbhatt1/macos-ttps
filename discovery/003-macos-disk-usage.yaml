api_version: 2.0
id: c3d4e5f6-a7b8-49ca-d1e2-f3a4b5c6d7e8
name: Gather macOS Disk Usage and Storage Information
authors:
  - security_team
description: Enumerate mounted filesystems, disk space usage, and storage capacity to assess available disk resources
requirements:
  platforms:
    - os: darwin
tests:
  - name: dry_run
    dry_run: true
steps:
  - name: Get Disk Space Usage
    executor:
      name: sh
      command: df -h
      timeout: 10
  - name: Get Storage Information
    executor:
      name: sh
      command: system_profiler SPStorageDataType
      timeout: 10
  - name: List Mounted Volumes
    executor:
      name: sh
      command: mount | grep -v "^/dev/null"
      timeout: 5
  - name: Get Disk Partition Info
    executor:
      name: sh
      command: diskutil list
      timeout: 10
  - name: Get SMART Status
    executor:
      name: sh
      command: diskutil info / | grep -E "Connection|Device Block Size"
      timeout: 5
checks:
  - name: Root Filesystem Check
    executor:
      name: sh
      command: df / | tail -1
      timeout: 5
  - name: Mounted Filesystems Count
    executor:
      name: sh
      command: mount | wc -l
      timeout: 5
